---
title: "Visualization using ggplot2"
author: "Ozan Jaquette"
date: 
urlcolor: blue
output: 
  github_document:
    toc: TRUE
    toc_depth: 2
    #fig_width = 7 #Default width (in inches) for figures
    #fig_height = 5 #Default height (in inches) for figures
    html_preview: TRUE #TRUE to also generate an HTML file for the purpose of locally previewing what the document will look like on GitHub.    
    df_print: tibble # Method to be used for printing data frames. Valid values include "default", "kable", "tibble", and "paged". The "default" method uses print.data.frame. 
    
    #Options you are not using yet:
      
    #dev = "png" #Graphics device to use for figure output (defaults to png)
    #includes = NULL #Named list of additional content to include within the document (typically created using the includes function).
    #md_extensions = NULL # Markdown extensions to be added or removed from the default definition or R Markdown. See the rmarkdown_format for additional details.
    #hard_line_breaks = TRUE # TRUE to generate markdown that uses a simple newline to represent a line break (as opposed to two-spaces and a newline).
    #pandoc_args = NULL # Additional command line options to pass to pandoc

bibliography: ../rclass2_bib.bib
csl: ../apa.csl
---

# Intro/logistics

Load packages
```{r, message=FALSE}
library(tidyverse)
library(ggplot2) # superfluous because ggplot2 is part of tidyverse

library(haven)
library(labelled)
```

Resources used to create this lecture

- https://r4ds.had.co.nz/data-visualisation.html
- https://cfss.uchicago.edu/notes/grammar-of-graphics/#data-and-mapping
- https://codewords.recurse.com/issues/six/telling-stories-with-data-using-the-grammar-of-graphics
- http://r-statistics.co/Complete-Ggplot2-Tutorial-Part1-With-R-Code.html
- https://ggplot2-book.org/

## Datasets we will use

We will use two datasets that are part of the `ggplot2` package

- `mpg`: EPA fuel economy data in 1999 and 2008 for 38 car models that had a new release every year between 1999 and 2008
    - note: no set of variables that uniquely identify observations
- `diamonds`: prices and attributes of about 54,000 diamonds

```{r}
#?mpg
glimpse(mpg)
  #Uniquely identify obs?
  #mpg %>% group_by(manufacturer,model,cyl,trans,drv,fl,year) %>% count()
  #mpg %>% group_by(manufacturer,model,cyl,trans,drv,fl,year,displ,cty,hwy,class) %>% count()
```

```{r}
#?diamonds
glimpse(diamonds)
```

We will use public-use data from the National Center for Education Statistics (NCES) Educational Longitudinal Survey (ELS) of 2002

- follows 10th graders from 2002 until 2012
- variable `stu_id` uniquely identifies observations
```{r}

## variables we want to select from full ELS dataset
els_keepvars <- c(
    "STU_ID",        # student id
    "STRAT_ID",      # stratum id
    "PSU",           # primary sampling unit
    "BYRACE",        # (base year) race/ethnicity 
    "BYINCOME",      # (base year) parental income
    "BYPARED",       # (base year) parental education
    "BYNELS2M",      # (base year) math score
    "BYNELS2R",      # (base year) reading score
    "F3ATTAINMENT",  # (3rd follow up) attainment
    "F2PS1SEC",      # (2nd follow up) first institution attended
    "F3ERN2011",     # (3rd follow up), earnings from employment in 2011
    "F1SEX",         # (1st follow up) sex composite
    "F2EVRATT",      # (2nd follow up, composite) ever attended college
    "F2PS1LVL",      # (2nd follow up, composite) first attended postsecondary institution, level 
    "F2PS1CTR",      # (2nd follow up, composite) first attended postsecondary institution, control
    "F2PS1SLC"       # (2nd follow up, composite) first attended postsecondary institution, selectivity
)
els_keepvars

    
if (!exists("els")) { # if object named "els" does not exist, read in stata dataset
  els <- read_dta(file="C:/Users/ozanj/Documents/rclass2/data/els/els_02_12_byf3pststu_v1_0.dta") %>%
    # keep only subset of vars
    select(one_of(els_keepvars)) %>%
    # lower variable names
    rename_all(tolower)
}

glimpse(els)

els %>% var_label()

#count number of obs per student id
els %>% group_by(stu_id) %>% # group by your candidate key
  summarise(n_per_id=n()) %>% # create a measure of number of observations per group
  ungroup %>% # ungroup, otherwise frequency table [next step] created separately for each group
  count(n_per_id) # frequency of number of observations per group
```


```{r, eval = FALSE}

#UNROLLMENT_PROJ DATA
elsdir <- "C:/Users/ozanj/Documents/unrollment_proj/data/cleaned"

list.files(path= elsdir)
file.path(elsdir)
file.path(elsdir,"els.Rds")

df <- readRDS(file = file.path(elsdir, "els.Rds"))
df
glimpse(df)
```


# Concepts

Grammar

- Grammar
    - "the fundamental principles or rules of an art or science" [Oxford English dictonary]
- Grammar of graphics [@RN4563]
    - Principles/rules to describe and construct statistical graphics
- Layered grammar of graphics [@RN4561]
    - Principles/rules to describe and construct statistical graphics "based around the idea of building up a graphic from multiple layers of data" [@RN4561, p. 4]
    - The layered grammar of graphics is a "formal system for building plots...based on the insight that you can uniquely describe _any_ plot as a combination of" seven paramaters [@RN4564, chapter 3] 
- Aesthetics
    - __aesthetics__ are visual elements of the plot (e.g., lines, points, symbols, colors, axes)
    - __aesthetic mappings__ are visual elements of the plot determined by values of specific variables (e.g., a scatterplot where the color of each point depends on the value of the variable `race`)
    - However, aesthetics need not be determined by variable values. For example, when creating scatterplot you may specify that the color of each point be blue

The seven parameters of the layered grammar of graphics consists of:

- five layers
    - a dataset (__data__)
    - a set of aesthetic mappings (__mappings__)
    - a statistical transformation (__stat__)
    - a geometric object (__geom__)        
    - a position adjustment (__position__)
- a coordinate system (__coord__)
- a faceting scheme (__facets__)

`ggplot2` -- part of the `tidyverse` -- is an R package to create graphics and `ggplot` is a function within the `ggplot2` package. 

> In practice, you rarely need to supply all seven parameters to make a graph because ggplot2 will provide useful defaults for everything except the data, the mappings, and the geom function [@RN4564, chapter 3]

Syntax conveying the seven parameters of the layered grammer of graphics

```{r, eval = FALSE}
ggplot(data = <DATA>) + 
  <GEOM_FUNCTION>(
     mapping = aes(<MAPPINGS>),
     stat = <STAT>, 
     position = <POSITION>
  ) +
  <COORDINATE_FUNCTION> +
  <FACET_FUNCTION>
```

## Layers

What does Wickham mean by __layers__? (from "[Telling Stories with Data Using the Grammar of Graphics](https://codewords.recurse.com/issues/six/telling-stories-with-data-using-the-grammar-of-graphics)" by Liz Sander)

- In the grammar of a language, words have different parts of speach (e.g., noun, verb, adjective), with each part of speech performing a different role in a sentence
- the layered grammar of graphics decomposes a graphic into different __layers__
    - "These are layers in a literal sense â€“ you can think of them as transparency sheets for an overhead projector, each containing a piece of the graphic, which can be arranged and combined in a variety of ways."


The five layers of the grammar of graphics:

- a dataset (__data__); a set of mappings (__mappings__); a statistical transformation (__stat__); a geometric object (__geom__); a position adjustment (__position__)


### dataset (__data__)

- data defines the information to be visualized
- For example, imagine a dataset where each observation is a student and the variables of interest are high-school math test score, `bynels2m`, and earnings in 2011, `f3ern2011`

```{r}
glimpse(els)
els %>% select(stu_id,bynels2m,f3ern2011,f1sex) %>% as_factor() %>% head(10)
```

PROBABLY CUT THIS HYPOTHETICAL DATASET
```{r}
incage <- tribble(
  ~id, ~age, ~inc000,
  1, 30, 70,
  2, 20, 18,
  3, 25, 150,
  4, 50, 200,
  5, 65, 15
)
incage
```
### set of mappings (__mappings__)

- mapping defines how variables in a dataset are applied (mapped) to a graphic. 
- For example, map HS math test score to the x-axis and 2011 income to the y-axis
- Additionally, if we are creating a scatterplot of test score (x) and income (y), we might use sex to define the color of each point

```{r}

els %>% select(stu_id,bynels2m,f3ern2011,f1sex) %>% 
  rename(x=bynels2m, y=f3ern2011, color=f1sex) %>% 
  as_factor() %>% head(10)

```

ADD EXAMPLES

### statistical transformation (__stat__): 

- a statistical transformation transforms the underlying data before plotting it
- Imagine creating a scatterplot of the relationship HS math test score (x-axis) and 2011 income (y-axis)
    - When creating a scatterplot we usually do not transform the data prior to plotting. This is the "identity" transformation.
    
```{r}
els %>% select(stu_id,bynels2m,f3ern2011) %>% rename(x=bynels2m, y=f3ern2011) %>% 
  as_factor() %>% head(10)

```
    
- Imagine we have student-level data and want to create bar chart of the number of students by postsecondary institution type
    - Here, we do not plot the raw data. Rather, we count the number of observations within each system. This count is a statistical transformation.

MODIFY TO COMBINE CATEGORIES? OR MAYBE DRAW FROM A DIFFERENT INPUT VARIABLE?
```{r}
#glimpse(els)
els %>% count(f2ps1sec) %>% as_factor
```


### geometric objects (__geoms__)

- graphs visually display data, using geometric objects like a point, line, bar, etc.
- each geometric object in a graph is called a "geom"
- "A geom is the geometrical object that a plot uses to represent data" [@RN4564, chapter 3]
- "People often describe plots by the type of geom that the plot uses. For example, bar charts use bar geoms, line charts use line geoms, boxplots use boxplot geoms"  [@RN4564, chapter 3]
- __aesthetics__ are "visual attributes of the geom" (e.g., color, fill, shape, position) https://cfss.uchicago.edu/notes/grammar-of-graphics/
    - Each geom can only display certain aesthetics
    - For example, a "point geom" can only include the aesthetics position, color, shape, and size 
- We can plot the same underlying data using different geoms (e.g., bar chart vs. pie chart)
- A single graph can layer multiple geoms. For example, consider a scatterplot with a "line of best fit" layered on top

### position adjustment (__position__)

- Position adjustment adusts the position of visual elements in the plot so that these visual elements do not overlap one another in ways that make the plot difficult to interpret
- A simple example: 
    - The dataset `mpg` (included in the `ggplot2` package) contains variables for the specifications of different cars, with 234 observations
    - Create a scatterplot of the relationship between number of cylinders in the engine (x-axis) and highway miles-per gallon (y-axis)
    - Below plot is difficult to interpet because many points overlap with one another

```{r}
#glimpse(mpg)
ggplot(data = mpg, mapping = aes(x = cyl, y = hwy)) +
  geom_point()
```

- the `jitter` position adjustment "adds a small amount of random variation to the location of each point" (from ?geom_jitter)

```{r}
ggplot(data = mpg, mapping = aes(x = cyl, y = hwy)) +
  geom_point(position = "jitter")
```

### Coordinate system and faceting

Coordinate system (__coord__)

- "A coordinate system (coord) maps the position of objects onto the plane of the plot, and controls how the axes and grid lines are drawn. Plots typically use two coordinates (x,y), but could use any number of coordinates" https://cfss.uchicago.edu/notes/grammar-of-graphics/
- Most plots use the "Cartesian coordinate system" but other coordinate systems exist, such as the "polar coordinate system"
- From https://cfss.uchicago.edu/notes/grammar-of-graphics/:

```{r}
x1 <- c(1, 10)
y1 <- c(1, 5)
p <- qplot(x = x1, y = y1, geom = "blank", xlab = NULL, ylab = NULL) +
  theme_bw()

p +
  ggtitle(label = "Cartesian coordinate system")

p +
  coord_polar() +
  ggtitle(label = "Polar coordinate system")
```
- When using the default Cartesian coordinate system, a common task is to flip the x and y axis. From https://r4ds.had.co.nz/data-visualisation.html#coordinate-systems

```{r}
ggplot(data = mpg, mapping = aes(x = class, y = hwy)) + 
  geom_boxplot()
ggplot(data = mpg, mapping = aes(x = class, y = hwy)) + 
  geom_boxplot() +
  coord_flip()
```

Faceting scheme (__facets__)

- __facets__ are subplots that display one subset of the data
- facets are most commonly used to create "small multiples"
- For example, here we create a scatterplot of the relationship between engine cylinder (x-axis) and highway miles per gallon (y-axis), with separate subplots for car `class` (e.g., midsize, minivan, pickup, suv)

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = cyl, y = hwy), position = "jitter") + 
  facet_wrap(~ class, nrow = 2)
```

# Creating graphs using `ggplot`

## `ggplot() and `aes()` functions

Show index for package `ggplot2`
```{r, eval = FALSE}
help(package = ggplot2)
```

The `ggplot` function
```{r, eval = FALSE}
?ggplot

#SYNTAX AND DEFAULT VALUES
ggplot(data = NULL, mapping = aes())
```



- Description (from help file)
    - "`ggplot()` initializes a ggplot object. It can be used to declare the input data frame for a graphic and to specify the set of plot aesthetics intended to be common throughout all subsequent layers unless specifically overridden"
- Arguments
    - `data`: dataset to use for plot.  If not specified in `ggplot` function, must be supplied in each layer added to the plot.
    - `mapping`: default list of aesthetic mappings to use for plot. If not specified, must be supplied in each layer added to the plot
 
    
The `aes` function (often called within the `ggplot` function)    

```{r, eval = FALSE}
?aes

#SYNTAX
aes(x, y, ...)
``` 

- Description (from help file)
    - "Aesthetic mappings describe how variables in the data are mapped to visual properties (aesthetics) of geoms. Aesthetic mappings can be set in `ggplot()` and in individual layers."
- Arguments
    - `x`, `y`: List of name value pairs giving aesthetics to map to variables.
    - `...` additional aesthetic mappings specified by user
    
Putting `ggplot()` and `aes()` together


```{r}
ggplot(data= mpg, aes(x = displ, y = hwy))
```

- Specifying `ggplot()` and `aes()` without specifying a geom layer (e.g., `geom_point()`) creates a blank ggplot

```{r}
#diamonds
ggplot(data= diamonds, aes(x = carat, y = price))
```
- We can create assign a ggplot object for later use
```{r}
diam_ggplot <- ggplot(data= diamonds, aes(x = carat, y = price))

diam_ggplot # creates blank ggplot
```
- Investigate ggplot object
```{r}
typeof(diam_ggplot)
class(diam_ggplot)

str(diam_ggplot)
```

- Attributes of ggplot object
```{r}
attributes(diam_ggplot)

diam_ggplot$mapping

diam_ggplot$labels
```
## Adding geometric layer to a ggplot object using a "geom function"

Adding a geometric layer to a ggplot object dictates how observations are displayed in the plot

- Geometric layers are specified using "geom functions"
- There are many different geom functions. 
    - For example, `geom_point()` creates a scatterplot, `geom_bar()` creates a bar chart
- We will start by creating scatterplots
    - Scatterplots are most useful for showing the relationship between two continuous variables

### Scatterplots using `geom_point()`

```{r}
ggplot(data= diamonds, aes(x = carat, y = price)) + geom_point()
```
If we already created and assigned a ggplot object, we can use that object to create the plot
```{r}
diam_ggplot + geom_point()
```

Using the `els` data frame, let's create a scatterplot of the relationship between high school math test score (`bynels2m`, x-axis) and 2011 earnings (`f3ern2011`, y-axis)

- first, let's investigate the underlying variables
```{r}
els %>% select(bynels2m,f3ern2011) %>%
  summarize_all(.funs = list(~ mean(., na.rm = TRUE), ~ min(., na.rm = TRUE), ~ max(., na.rm = TRUE)))
```
- Investigate values less than zero
```{r}
els %>% select(bynels2m) %>% filter(bynels2m<0) %>% count(bynels2m)
els %>% select(bynels2m) %>% filter(bynels2m<0) %>% count(bynels2m) %>% as_factor()

els %>% select(f3ern2011) %>% filter(f3ern2011<0) %>% count(f3ern2011)
els %>% select(f3ern2011) %>% filter(f3ern2011<0) %>% count(f3ern2011) %>% as_factor()
```
- Create version of variables the replace values less than zero with `NA`

```{r}
els_v2 <- els %>% 
  mutate(
    hs_math = if_else(bynels2m<0,NA_real_,as.numeric(bynels2m)),
    earn2011 = if_else(f3ern2011<0,NA_real_,as.numeric(f3ern2011)),
  )

#check
els_v2 %>% filter(bynels2m<0) %>% count(bynels2m, hs_math)
els_v2 %>% filter(f3ern2011<0) %>% count(f3ern2011, earn2011)

els_v2 %>% count(bypared) %>% as_factor()
```
- to avoid scatterplot with too many points, create data frame consisting of students whose parents have a PhD or first professional degree
```{r}
els_parphd <- els_v2 %>% filter(bypared==8)
```

- Plot
```{r}
#ggplot(data= els_v2, aes(x = hs_math, y = earn2011)) + geom_point()
ggplot(data= els_parphd, aes(x = hs_math, y = earn2011)) + geom_point()
```


geom function syntax options (`geom_point()`)
```{r, eval = FALSE}
?geom_point
```

- Syntax (with defaults)
    - `geom_point(mapping = NULL, data = NULL, stat = "identity",
        position = "identity", ..., na.rm = FALSE, show.legend = NA,
        inherit.aes = TRUE)`
    - See arguments in help file
- Aesthetics: `geom_point()` understands (i.e., accepts) the following aesthetics (required aesthetics in bold)
    - __x__; __y__; alpha; colour; fill; group; shape; size; stroke
    - note: other geom functions (e.g., `geom_bar()`) accepts a different set of aesthetics

Scatterplot of relationship between engine displacement (`displ`, x) and highway miles per gallon (`hwy`, y), with color of points determined by type of car (`class`)
```{r}
ggplot(data = mpg, aes(x = displ, y = hwy, color = class)) + 
  geom_point()
```

- Alternatively, can specify the `color` aethetic within `geom_point()`

```{r}
ggplot(data = mpg, aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class))
```
  
  
Task: Create scatterplot of relationship between math score (x) and 2011 earnings (y), with color of points determined by sex (`f1sex`)

- below code doesn't work because `aes()` expects the "color" aesthetic to be a factor variable
```{r, eval = FALSE}
ggplot(data= els_parphd, aes(x = hs_math, y = earn2011, color = f1sex)) + geom_point()
```


```{r}
ggplot(data= els_parphd, aes(x = hs_math, y = earn2011, color = as_factor(f1sex))) + geom_point()
```
### Smoothed prediction lines using `geom_smooth()`

Motivation

- biggest problem with scatterplots is "overplotting." That is, when you plot many observations, points may be plotted on top of one another and difficult to visually discern the relationship

```{r}
ggplot(data= els_v2, aes(x = hs_math, y = earn2011)) + geom_point()
```



`geom_smooth()` creates smoothed prediction lines with shaded confidence intervals

- syntax, with default values (very similar to `geom_point()`)
    - `geom_smooth(mapping = NULL, data = NULL, stat = "smooth",
      position = "identity", ..., method = "auto", formula = y ~ x,
      se = TRUE, na.rm = FALSE, show.legend = NA, inherit.aes = TRUE)`
    - Note default "statistical transformation":
        - `stat = "smooth"` for `geom_smooth()`
        - `stat = "identity"` for `geom_point()`
- Aesthetics: `geom_smooth()` accepts the following aesthetics (required aesthetics in bold)
    - __x__; __y__; alpha; colour; fill; group; linetype; size; weight; ymax; ymin
    


```{r}
ggplot(data= els_v2, aes(x = hs_math, y = earn2011)) + geom_smooth()
```
- Same as above:
```{r}
ggplot(data= els_v2) + geom_smooth(mapping = aes(x = hs_math, y = earn2011))
```
- use `group` aesthetic to create separate prediction lines by sex (`f1sex`)
```{r}
ggplot(data= els_v2) + geom_smooth(mapping = aes(x = hs_math, y = earn2011, group=as_factor(f1sex)))
#same:
#ggplot(data= els_v2, aes(x = hs_math, y = earn2011, group=as_factor(f1sex))) + geom_smooth()
```
- use `linetype` aesthetic to create separate prediction lines (with different line styles) by sex (`f1sex`)
```{r}
ggplot(data= els_v2) + geom_smooth(mapping = aes(x = hs_math, y = earn2011, linetype=as_factor(f1sex)))
#same:
#ggplot(data= els_v2, aes(x = hs_math, y = earn2011, linetype=as_factor(f1sex))) + geom_smooth()
```
- use `color` aesthatic to create separate prediction lines (with different colors) by sex (`f1sex`)
```{r}
ggplot(data= els_v2) + geom_smooth(mapping = aes(x = hs_math, y = earn2011, color=as_factor(f1sex)))
#same:
ggplot(data= els_v2, aes(x = hs_math, y = earn2011, color=as_factor(f1sex))) + geom_smooth()
```

### Plot multiple geom layers by adding multiple geom functions

Layer smoothed prediction line (`geom_smooth()`) on top of scatterplot (`geom_point()`)

```{r}
ggplot(data= els_v2) + 
  geom_point(mapping = aes(x = hs_math, y = earn2011)) + 
  geom_smooth(mapping = aes(x = hs_math, y = earn2011))
```
- can create same plot using this syntax:
```{r}
ggplot(data= els_v2, aes(x = hs_math, y = earn2011)) + 
  geom_point() +
  geom_smooth()
```

- Adjust x-axis and y-axis limits by using `+ xlim()` and `+ ylim()`

```{r}
ggplot(data= els_v2, aes(x = hs_math, y = earn2011)) + 
  geom_point() +
  geom_smooth() +
  xlim(c(20,80)) + ylim(c(0,100000))
```

- layer smooth line (with different color )
- Layer smoothed prediction line with different line types by sex (`f1sex`) on top of scatterplot with color of points determined by sex
```{r}
ggplot(data= els_v2) + 
  geom_point(mapping = aes(x = hs_math, y = earn2011, color = as_factor(f1sex))) + 
  geom_smooth(mapping = aes(x = hs_math, y = earn2011, linetype = as_factor(f1sex))) +
  xlim(c(20,80)) + ylim(c(0,100000))
```
- same as above [chunk not evaluated]
```{r, eval = FALSE}
ggplot(data= els_v2, aes(x = hs_math, y = earn2011, color = as_factor(f1sex))) + 
  geom_point() + 
  geom_smooth() +
  xlim(c(20,80)) + ylim(c(0,100000))
```

### Bar charts (`geom_bar()`) to plot a single, discrete variable

Bar charts:

- X-axis typically represents a categorical variable (e.g,. race, gender, institutional type)
    - Each value of the categorical variable is a "group"
- Y-axis often represents the number of cases in a group (or the proportion of cases in a group)
    - But height of bar could also represent mean value for a group or some other summary statistic (e.g., min, max, std)


Two geom functions to create bar charts

- `geom_bar()`: the height of each bar represents the number of cases (i.e., observations) in the group
    - Statistical transformation = "count"
        - counts the number of cases in each group
        - Y value for a group is number of cases in the group
    - Use `geom_bar()` when using (for example) student-level data and you don't want to summarize student-level data prior to creating the chart
- `geom_col()`: the height of the bar represents the value of some variable for the group
    - Statistical transformation = "identity"
        - Y-value for a group is the value of a variable in the data frame
    - Use `geom_col()` when you have already created an object of summary statistics (e.g., counts, mean value, etc.)
```{r, eval = FALSE}
?geom_bar
?geom_col
```

Task: Using data frame `diamonds`, create a bar chart w/ variable `cut` (e.g. "Fair," "Good," "Ideal") as x-axis and number of diamonds as y-axis

1. Create bar chart using `geom_bar()`
1. Create bar chart using `geom_col()`

Essentially, you are being asked to create a bar chart from the following frequency count:
```{r}
diamonds %>% count(cut)
```


Create bar chart of `cut`  using `geom_bar()`
```{r}
ggplot(data = diamonds, aes(x = cut)) +
  geom_bar()
```
Create bar chart of `cut`  using `geom_col()`
```{r}
#first create an object of frequency count of variable cut
cut <- diamonds %>% count(cut)
cut

#next, use ggplot() + geom_col to plot the data fram object cut
ggplot(data = cut, aes(x = cut, y=n)) +
  geom_col()
```
- We can also use `bar_col()` to create bar chart of `cut` without creating separate object first
```{r}
diamonds %>% count(cut) %>% str()

#below, we can omit the data argument from ggplot because we pipe in value of first argument
diamonds %>% count(cut) %>% ggplot(aes(x= cut, y=n)) + geom_col()
```


Task: Using data frame `els`, create a bar chart w/ variable "ever attended postsecondary education" (`f2evratt`) as x-axis and number of students as y-axis

1. Create bar chart using `geom_bar()`
1. Create bar chart using `geom_col()`

Essentially, you are being asked to create a bar chart from the following frequency count:
```{r}
#glimpse(els_v2)
els_v2 %>% select(f2evratt) %>% var_label()

#ever attended
els_v2 %>%  count(f2evratt)
els_v2 %>%  count(f2evratt) %>% as_factor()
```

Create bar chart of `f2evratt`  using `geom_bar()`
```{r}
ggplot(data = els_v2, aes(x = as_factor(f2evratt))) +
  geom_bar()

#we can use pipes and then omit the first argument of ggplot, which specifies the data frame we will plot
els_v2 %>% ggplot(aes(x = as_factor(f2evratt))) +
  geom_bar()

#Using pipes, we can filter values of f2evratt before plotting
els_v2 %>% filter(f2evratt>=0) %>% ggplot(aes(x = as_factor(f2evratt))) +
  geom_bar()
```
Create bar chart of `f2evratt`  using `geom_col()`
```{r}
els_v2 %>% 
  ## filter to remove missing values
  filter(f2evratt>=0) %>% 
  ## use count() to create summary statistics object
  count(f2evratt) %>%
  ## plot summary statistic object
  ggplot(aes(x=as_factor(f2evratt), y=n)) + geom_col()
```

### relationship between discrete x and discrete y


```{r}
els_v2 %>% select(f2evratt,f2ps1lvl) %>% var_label()

#ever attended
els_v2 %>%  count(f2evratt)
els_v2 %>%  count(f2evratt) %>% as_factor()

#level of first postsec institution
els_v2 %>%  count(f2ps1lvl)
els_v2 %>%  count(f2ps1lvl) %>% as_factor()

#ever attended by level attended
els_v2 %>%  count(f2evratt,f2ps1lvl)
els_v2 %>%  count(f2evratt,f2ps1lvl) %>% as_factor()

```

## Small multiples using faceting

# References